---
title: Jenkins + docker + nginx 自动化构建搭建 (一) --- 配置基本环境
tags:
  - 自动化
  - 持续集成
categories:
  - 自动化
  - 持续集成
date: 2019-03-01 11:27:52
---

![](https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=1855844663,2646560550&fm=26&gp=0.jpg)

## 你需要准备的环境（这里以阿里云ECS Ubuntu 16.04 为例）

---
- 服务器： 阿里云服务器ECS
- 操作系统:    Ubuntu 16.04
---

## (一) 修改阿里云ECS默认主机名

---

需要修改两处：

```
vi /etc/hostname
<!--将其对应的主机名修改为新的主机名-->

vi /etc/hosts
<!--需要将 /etc/hosts 中 127.0.0.1 对应的老主机名更换为新的主机名-->

<!--重启服务器生效-->

```

修改完毕后重新 shell 登录即可

---

## (二) 为Ubuntu系统添加新的普通用户

---

在使用Ubuntu系统的过程中，一般不建议直接使用root用户，建议新建一个或多个普通用户，平时的操作都使用普通用户登录Ubuntu系统。

使用root用户登录Ubuntu系统以后，打开一个终端，在终端中执行如下Shell命令


```
sudo useradd -m roy -s /bin/bash
```

这条命令创建了可以登陆的 linziyu 用户，并使用 /bin/bash 作为 shell

接着使用如下命令为这个新用户设置密码，请按系统提示输入两次密码：

```
sudo passwd roy
```

可为roy 用户增加管理员权限，方便部署，避免一些对新手来说比较棘手的权限问题

```
sudo adduser roy sudo
```

然后，把登录用户从root用户切换到roy用户，命令如下：


```
su roy
```

---

## (三) 创建ssh公、私钥 (使用root用户)

---

```
ssh-keygen -t rsa -C "your@email.com"
```

连续回车三次即可

---

## (四) 安装docker环境

---
#### 1. 卸载旧版本docker(全新安装时，无需执行该步骤)
```
sudo apt-get remove docker docker-engine docker.io
```

#### 2. 更新系统软件
```
sudo apt-get update
```

#### 3. 安装依赖包
```
sudo apt-get install apt-transport-https ca-certificates curl software-properties-common 
```

### 4. 添加Docker官方的GPG密钥

```

curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
<!--显示OK,表示添加成功.-->
<!--执行该命令时，如遇到长时间没有响应说明网络连接不到docker网站，需要使用代理进行-->

```

#### 5. 添加设置stable存储库
```
sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable"
```

#### 6. 再更新一下apt包索引
```
sudo apt-get update
```

#### 7. 再更新一下apt包索引
```
sudo apt-get install docker-ce

<!--在生产系统上，可能会需要应该安装一个特定版本的Docker CE，而不是总是使用最新版本：-->
<!--apt-cache madison docker-ce--> <!--列出可用的版本-->
<!--sudo apt-get install docker-ce=<VERSION>-->
```

#### 8. 验证docker
```
<!--查看docker版本：-->
docker -v
<!--Docker version 18.06.1-ce, build e68fc7a--> <!--出现类似以上信息代表安装成功-->

<!--查看docker服务是否启动：-->
systemctl status docker

<!--若未启动，则启动docker服务：-->
sudo systemctl start docker

<!--hello world测试：-->
sudo docker run hello-world
<!--若是出现Hello from Docker字样代表成功 -->

```

#### 9. docker-compose安装
```
sudo curl -L "https://github.com/docker/compose/releases/download/1.22.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose

sudo chmod +x /usr/local/bin/docker-compose

docker-compose --version
<!--docker-compose version 1.22.0, build f46880fe-->
<!--出现上述字样代表安装成功-->
```

---
